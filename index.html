<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PREVIEW - Sindicato del Crimen</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/estilos.css">
</head>
<body>

<!-- PRELOAD DEL SONIDO DE ALARMA -->
<audio id="alarma" src="audio/alarm.wav" preload="auto"></audio>

<div id="loader" class="loader-screen" style="display:none;">
  <div class="loader-terminal">
    <pre id="loaderText"></pre>
    <div class="loader-bar-container"><div class="loader-bar"></div></div>
  </div>
</div>

<div id="termsModal" class="modal">
  <div class="modal-content">
    <h2>ACCESO RESTRINGIDO</h2>
    <p>Este sistema pertenece al Sindicato del Crimen.<br>Autorizaci√≥n requerida para continuar.</p>
    <button onclick="startAccess()">Autorizar acceso</button>
  </div>
</div>

<div class="container" style="display:none;">
  <header class="main-header">
    <div class="header-logo">‚ü® SDC-NET ‚ü©</div>
    <h1 class="header-title">Sindicato del Crimen<br>Sistema Central</h1>
    <div class="header-status">‚óè ONLINE</div>
  </header>

  <nav class="main-nav">
    <button class="nav-btn active" onclick="location.href='index.html'"><span class="icon">üè†</span><span class="label">Inicio</span></button>
    <button class="nav-btn" onclick="location.href='noticias.html'"><span class="icon">üì∞</span><span class="label">Noticias</span></button>
    <button class="nav-btn" onclick="location.href='chat.html'"><span class="icon">üí¨</span><span class="label">Chat</span></button>
    <button class="nav-btn" onclick="location.href='sistema.html'"><span class="icon">‚öôÔ∏è</span><span class="label">Sistema</span></button>
  </nav>

  <section class="count-section">
    <h2>Cuenta atr√°s</h2>
    <div id="countdown">Cargando‚Ä¶</div>
  </section>
</div>

<script>
/* ======================================================
   DESBLOQUEO AUTOM√ÅTICO DE VOZ + AUDIO PARA iPHONE
====================================================== */

let vozOK = false;
let audioOK = false;

function unlockAudioAndVoice() {

  // Utterance silencioso ‚Üí desbloquea speechSynthesis en iOS
  const init = new SpeechSynthesisUtterance(".");
  init.volume = 0;
  init.lang = "es-ES";
  speechSynthesis.speak(init);
  vozOK = true;

  // Reproducir y pausar el audio ‚Üí desbloquea HTML5 audio
  const alarma = document.getElementById("alarma");
  alarma.volume = 0;
  alarma.play().then(() => {
    alarma.pause();
    alarma.currentTime = 0;
    audioOK = true;
  }).catch(() => {
    // iOS a veces requiere 2 intentos, lo reintentamos silencioso
    setTimeout(() => {
      alarma.play().then(() => {
        alarma.pause();
        alarma.currentTime = 0;
        audioOK = true;
      });
    }, 150);
  });
}


/* ======================================================
   FUNCI√ìN DE VOZ
====================================================== */
function speakOmega() {
  if (!vozOK) return;

  const msg = new SpeechSynthesisUtterance("Protocolo Omega activado.");
  msg.pitch = 0.5;
  msg.rate = 0.9;
  msg.volume = 1.0;
  msg.lang = "es-ES";
  speechSynthesis.speak(msg);
}


/* ======================================================
   ARRANQUE DEL SISTEMA
====================================================== */
function startAccess() {

  // 1Ô∏è‚É£ DESBLOQUEO DE VOZ + AUDIO (iPhone compatible)
  unlockAudioAndVoice();

  // 2Ô∏è‚É£ Animaci√≥n de acceso
  document.getElementById('termsModal').style.display = 'none';
  document.getElementById('loader').style.display = 'flex';
  typeLine();

  setTimeout(() => {
    document.getElementById("loader").classList.add("loader-hide");
    setTimeout(() => {
      document.getElementById("loader").style.display = "none";
      document.querySelector('.container').style.display = 'block';
    }, 900);
  }, 5000);
}


/* ======================================================
   TERMINAL DE CARGA
====================================================== */
const loaderLines = [
  "[ MONITORING NODE ONLINE ]",
  "Rastreando actividad del usuario...",
  "Localizando direcci√≥n IP...",
  "Analizando patrones de comportamiento...",
  "Estableciendo vigilancia permanente...",
  "Conectando con nodos ocultos...",
  "Cifrando informaci√≥n sensible...",
  "Acceso concedido ‚úî"
];

let indexLoader = 0;
let textElement = document.getElementById("loaderText");

function typeLine() {
  if (indexLoader < loaderLines.length) {
    textElement.textContent += loaderLines[indexLoader] + "\n";
    indexLoader++;
    setTimeout(typeLine, 430);
  }
}


/* ======================================================
   COUNTDOWN
====================================================== */
let countdownInterval = null;

function startCountdown() {
  countdownInterval = setInterval(updateCountdown, 1000);
  updateCountdown();
}

function updateCountdown() {
  const target = new Date("2025-12-08T18:10:00");
  const now = new Date();
  const diff = target - now;
  const box = document.getElementById('countdown');
  if (!box) return;

  if (diff <= 0) {
    clearInterval(countdownInterval);

    // 1Ô∏è‚É£ Pitido de alarma
    const alarma = document.getElementById("alarma");
    if (audioOK) {
      alarma.volume = 1;
      alarma.play();
    }

    // 2Ô∏è‚É£ Voz del protocolo
    speakOmega();

    box.innerHTML = `
      <div class="scanlines">
        <div class="glitch" data-text="‚ö† PROTOCOLO OMEGA ACTIVADO ‚ö†">
          ‚ö† PROTOCOLO OMEGA ACTIVADO ‚ö†
        </div><br><br>

        <div class="glow-anim">
          El Sindicato del Crimen confirma el inicio de la operaci√≥n<br>
          <b>"NOCHE NEGRA 7"</b>.
        </div><br>

        <div class="alert-blink">
          Canal Omega abierto ‚Äî Contrase√±a li24ruXIMAYpar175
        </div>
      </div>
    `;
    return;
  }

  const hours = String(Math.floor(diff / 1000 / 60 / 60)).padStart(2, "0");
  const minutes = String(Math.floor(diff / 1000 / 60 % 60)).padStart(2, "0");
  const seconds = String(Math.floor(diff / 1000 % 60)).padStart(2, "0");
  box.innerText = `${hours}:${minutes}:${seconds}`;
}

startCountdown();


/* ======================================================
   SCROLL HEADER FX
====================================================== */
window.addEventListener('scroll', () => {
  const header = document.querySelector('.main-header');
  const nav = document.querySelector('.main-nav');
  if (window.scrollY > 20) {
    header.classList.add('scrolled');
    nav.classList.add('scrolled');
  } else {
    header.classList.remove('scrolled');
    nav.classList.remove('scrolled');
  }
});
</script>

</body>
</html>
