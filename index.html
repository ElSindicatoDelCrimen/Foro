<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PREVIEW - Sindicato del Crimen</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300;400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/estilos.css">
</head>
<body>

<div id="loader" class="loader-screen" style="display:none;">
  <div class="loader-terminal">
    <pre id="loaderText"></pre>
    <div class="loader-bar-container"><div class="loader-bar"></div></div>
  </div>
</div>

<div id="termsModal" class="modal">
  <div class="modal-content">
    <h2>ACCESO RESTRINGIDO</h2>
    <p>Este sistema pertenece al Sindicato del Crimen.<br>Autorizaci√≥n requerida para continuar.</p>
    <button onclick="startAccess()">Autorizar acceso</button>
  </div>
</div>

<div class="container" style="display:none;">
  <header class="main-header">
    <div class="header-logo">‚ü® SDC-NET ‚ü©</div>
    <h1 class="header-title">Sindicato del Crimen<br>Sistema Central</h1>
    <div class="header-status">‚óè ONLINE</div>
  </header>

  <nav class="main-nav">
    <button class="nav-btn active" onclick="location.href='index.html'"><span class="icon">üè†</span><span class="label">Inicio</span></button>
    <button class="nav-btn" onclick="location.href='noticias.html'"><span class="icon">üì∞</span><span class="label">Noticias</span></button>
    <button class="nav-btn" onclick="location.href='chat.html'"><span class="icon">üí¨</span><span class="label">Chat</span></button>
    <button class="nav-btn" onclick="location.href='sistema.html'"><span class="icon">‚öôÔ∏è</span><span class="label">Sistema</span></button>
  </nav>

  <section class="count-section">
    <h2>Cuenta atr√°s</h2>
    <div id="countdown">Cargando‚Ä¶</div>
  </section>
</div>

<script>
/* ======================================================
   SIRENA MILITAR (SIN ARCHIVOS ‚Äî FUNCIONA EN IPHONE)
====================================================== */
function sonarSirenaMilitar() {
  try {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();

    osc.type = "sawtooth";
    osc.connect(gain);
    gain.connect(audioContext.destination);

    let t = audioContext.currentTime;
    const cycles = 4;

    for (let i = 0; i < cycles; i++) {
      osc.frequency.setValueAtTime(600, t);
      gain.gain.setValueAtTime(0.7, t);
      t += 0.25;

      osc.frequency.setValueAtTime(300, t);
      gain.gain.setValueAtTime(0.7, t);
      t += 0.25;
    }

    gain.gain.setValueAtTime(0, t);
    osc.start(audioContext.currentTime);
    osc.stop(t + 0.1);

  } catch(e) {
    console.warn("Error al reproducir sirena militar:", e);
  }
}

/* ======================================================
   DESBLOQUEO DE AUDIO Y VOZ PARA iPHONE
====================================================== */
let vozOK = false;

function unlockAudioAndVoice() {

  // DESBLOQUEO DE VOZ
  const init = new SpeechSynthesisUtterance(".");
  init.volume = 0;
  init.lang = "es-ES";
  try { speechSynthesis.speak(init); } catch(e) {}
  vozOK = true;

  // DESBLOQUEO DE WEB AUDIO (INDISPENSABLE PARA IPHONE)
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const empty = ctx.createOscillator();
    empty.frequency.value = 0;
    empty.connect(ctx.destination);
    empty.start();
    empty.stop();
  } catch(e) {}
}

/* ======================================================
   VOZ FINAL
====================================================== */
function speakOmega() {
  if (!vozOK) return;
  const msg = new SpeechSynthesisUtterance("Protocolo Omega activado.");
  msg.pitch = 0.5;
  msg.rate = 0.9;
  msg.volume = 1.0;
  speechSynthesis.speak(msg);
}

/* ======================================================
   ARRANQUE DEL SISTEMA
====================================================== */
function startAccess() {

  unlockAudioAndVoice();

  document.getElementById('termsModal').style.display = 'none';
  document.getElementById('loader').style.display = 'flex';
  typeLine();

  setTimeout(() => {
    document.getElementById("loader").classList.add("loader-hide");
    setTimeout(() => {
      document.getElementById("loader").style.display = "none";
      document.querySelector('.container').style.display = 'block';
    }, 900);
  }, 5000);
}

/* ======================================================
   ANIMACI√ìN TERMINAL
====================================================== */
const loaderLines = [
  "[ MONITORING NODE ONLINE ]",
  "Rastreando actividad del usuario...",
  "Localizando direcci√≥n IP...",
  "Analizando patrones de comportamiento...",
  "Estableciendo vigilancia permanente...",
  "Conectando con nodos ocultos...",
  "Cifrando informaci√≥n sensible...",
  "Acceso concedido ‚úî"
];

let indexLoader = 0;
let textElement = document.getElementById("loaderText");

function typeLine() {
  if (indexLoader < loaderLines.length) {
    textElement.textContent += loaderLines[indexLoader] + "\n";
    indexLoader++;
    setTimeout(typeLine, 430);
  }
}

/* ======================================================
   COUNTDOWN (FECHA DE AYER = ACTIVADO YA)
====================================================== */
let countdownInterval = null;

function startCountdown() {
  countdownInterval = setInterval(updateCountdown, 1000);
  updateCountdown();
}

function updateCountdown() {

  // FECHA DE AYER PARA ACTIVAR AUTOM√ÅTICAMENTE
  const target = new Date();
  target.setDate(target.getDate() - 1);

  const now = new Date();
  const diff = target - now;
  const box = document.getElementById('countdown');

  if (diff <= 0) {
    clearInterval(countdownInterval);

    sonarSirenaMilitar();
    speakOmega();

    box.innerHTML = `
      <div class="scanlines">
        <div class="glitch" data-text="‚ö† PROTOCOLO OMEGA ACTIVADO 2 ‚ö†">
          ‚ö† PROTOCOLO OMEGA ACTIVADO ‚ö†
        </div><br><br>

        <div class="glow-anim">
          El Sindicato del Crimen confirma el inicio de la operaci√≥n<br>
          <b>"NOCHE NEGRA NAVIDE√ëA"</b>.
        </div><br>

        <div class="alert-blink">
          Canal Omega abierto ‚Äî Contrase√±a li24ruXIMAYpar175
        </div>
      </div>
    `;
    return;
  }

  box.innerText = "00:00:00";
}

startCountdown();

/* ======================================================
   SCROLL HEADER FX
====================================================== */
window.addEventListener('scroll', () => {
  const header = document.querySelector('.main-header');
  const nav = document.querySelector('.main-nav');
  if (window.scrollY > 20) {
    header.classList.add('scrolled');
    nav.classList.add('scrolled');
  } else {
    header.classList.remove('scrolled');
    nav.classList.remove('scrolled');
  }
});
</script>

</body>
</html>

